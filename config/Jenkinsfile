pipeline {
    agent any

    environment {
        PYTHON = 'python3' // Asegúrate de que Python está instalado y accesible en Jenkins
    }

    stages {
        stage('Preparar Entorno') {
            steps {
                script {
                    sh "${PYTHON} --version" // Verifica la versión de Python
                    sh "${PYTHON} -m pip install --upgrade pip" // Actualiza pip
                    sh "${PYTHON} -m pip install -r requirements.txt" // Instala dependencias
                }
            }
        }

        stage('Ejecutar Script de Python') {
            steps {
                script {
                    sh "${PYTHON} enviar_correo.py" // Ejecuta el script de Python
                }
            }
        }
    }

    post {
        success {
            echo "Pipeline ejecutado con éxito. ✅"
            emailext (
                subject: "Pipeline Exitoso: ${env.JOB_NAME}",
                body: "El pipeline ha sido ejecutado con éxito en ${env.BUILD_URL}.",
                recipientProviders: [[$class: 'DevelopersRecipientProvider']]
            )
        }
        failure {
            echo "El pipeline ha fallado. ❌"
            emailext (
                subject: "Pipeline Fallido: ${env.JOB_NAME}",
                body: "El pipeline ha fallado. Revisa los logs en ${env.BUILD_URL} para más detalles.",
                recipientProviders: [[$class: 'DevelopersRecipientProvider']]
            )
        }
    }
}
